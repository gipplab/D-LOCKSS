@startuml D-LOCKSS Component Diagram

package "Core Components" {
    component ShardManager
    component "Storage Manager" as StorageManager
    component "Replication Checker" as ReplicationChecker
    component "File Operations" as FileOperations
    component Metrics
    component "Rate Limiter" as RateLimiter
    component "Backoff Manager" as BackoffManager
    component "Storage Monitor" as StorageMonitor
}

ShardManager --> StorageManager : checks responsibility
ReplicationChecker --> StorageManager : manages pins
ReplicationChecker --> ShardManager : publishes NEED
FileOperations --> StorageManager : pins files
FileOperations --> ShardManager : checks responsibility
ReplicationChecker --> BackoffManager : checks backoff
ShardManager --> RateLimiter : filters messages
RateLimiter --> StorageMonitor : checks disk usage
StorageMonitor --> StorageManager : monitors disk
Metrics --> StorageManager : reads state
Metrics --> ReplicationChecker : tracks stats

note right of ShardManager
    Manages shard assignment
    and PubSub topics
end note

note right of StorageManager
    Manages pinned files
    and known files tracking
end note

note right of ReplicationChecker
    Periodic replication
    level verification
end note

note right of FileOperations
    File ingestion
    and hash calculation
end note

note right of Metrics
    Metrics collection
    and CSV export
end note

note right of RateLimiter
    Per-peer message
    rate limiting
end note

note right of BackoffManager
    Exponential backoff
    for failed operations
end note

note right of StorageMonitor
    Monitors disk usage
    and rejects custodial files
    when disk is full
end note

@enduml
