@startuml D-LOCKSS Component Diagram

package "Core Components" {
    component "ShardManager" as ShardManager
    component "StorageManager" as StorageManager
    component "ReplicationManager" as ReplicationManager
    component "FileProcessor" as FileProcessor
    component Metrics
    component "Rate Limiter" as RateLimiter
    component "Storage Monitor" as StorageMonitor
}

ShardManager --> StorageManager : updates state (reshard)
ReplicationManager --> StorageManager : pins/unpins, check state
ReplicationManager --> ShardManager : uses for responsibility check
FileProcessor --> StorageManager : pins files, adds known
FileProcessor --> ShardManager : checks responsibility
ShardManager --> RateLimiter : filters messages
RateLimiter --> StorageMonitor : checks disk usage
Metrics --> StorageManager : reads stats
Metrics --> ReplicationManager : reads stats

note right of ShardManager
    Manages shard assignment
    and PubSub topics.
    Splits when overcrowded;
    late joiners in ROOT
    discover and join deeper shards.
end note

note right of StorageManager
    Owns local state:
    - PinnedFiles
    - KnownFiles
    - BackoffTable
end note

note right of ReplicationManager
    Owns pipeline:
    - Scheduler
    - Prober
    - Reconciler
end note

note right of FileProcessor
    File ingestion
    and Manifest creation
end note

@enduml
