@startuml File Lifecycle State Diagram

[*] --> Discovered: File detected in ./data

Discovered --> Pinned: pinFile(hash)
Discovered --> Custodial: Not responsible\nbut holds temporarily

Pinned --> Responsible: AmIResponsibleFor() == true
Pinned --> Custodial: AmIResponsibleFor() == false

Custodial --> Delegated: DELEGATE message sent
Delegated --> HandoffComplete: Replication >= MinReplication
HandoffComplete --> [*]: unpinFile()

Responsible --> Monitoring: Replication in range\n[MinReplication, MaxReplication]
Monitoring --> UnderReplicated: count < MinReplication
Monitoring --> OverReplicated: count > MaxReplication
Monitoring --> Removed: count > MaxReplication + 3

UnderReplicated --> Monitoring: Replication restored
OverReplicated --> Monitoring: Replication reduced

Responsible --> Removed: File no longer tracked
Removed --> [*]

note right of Custodial
    Temporary storage
    until responsible
    node takes over
end note

note right of Monitoring
    Periodic checks
    ensure replication
    stays in range
end note

@enduml
