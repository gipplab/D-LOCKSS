@startuml File Lifecycle State Diagram

[*] --> Discovered: File detected in ./data

Discovered --> Pinned: pinFile(ManifestCID)
Discovered --> Custodial: Not responsible\nbut holds temporarily

Pinned --> Responsible: AmIResponsibleFor(PayloadCID) == true
Pinned --> Custodial: AmIResponsibleFor(PayloadCID) == false

Custodial --> Delegated: DELEGATE message sent
Delegated --> HandoffComplete: Replication >= MinReplication
HandoffComplete --> [*]: unpinFile()

Responsible --> Monitoring: Replication in range
Monitoring --> UnderReplicated: count < MinReplication
Monitoring --> OverReplicated: count > MaxReplication

UnderReplicated --> Monitoring: Replication restored
OverReplicated --> Monitoring: Unpinned (but still tracked)

Responsible --> Removed: Shard split -> Not Responsible
Removed --> [*]

note right of Custodial
    Temporary storage
    until responsible
    node takes over
end note

note right of Monitoring
    Periodic checks
    ensure replication
    stays in range
end note

@enduml
